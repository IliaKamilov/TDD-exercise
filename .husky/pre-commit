echo "ğŸ” Running pre-commit checks..."

# Run Prettier Check
npx prettier --check .
if [ $? -ne 0 ]; then
    echo "âš ï¸ Prettier check errors found."
    echo "âš’ï¸ Running Prettier Fix..."
    npx prettier --write .
fi

# Run TypeScript type-check
echo "âš™ï¸ Running Typescript type-check..."
npx tsc --noEmit 
if [ $? -ne 0 ]; then
    echo "âŒ Type errors detected. Fix them before committing."
    exit 1
fi

# Run ESLint
echo "ğŸ” Running ESLint..."
npx next lint 
if [ $? -ne 0 ]; then
     echo "âŒ Lint errors detected. Fix them before committing."
  exit 1
fi

# Run Jest tests
echo "ğŸ§ª Running Jest tests..."
npx jest --passWithNoTests
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Fix them before committing."
  exit 1
fi

# Run Build
echo "ğŸ—ï¸ Running Build..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Fix errors before committing."
  exit 1
fi

# Check for security issues
echo "ğŸ”’ Running npm audit..."
npm audit --audit-level=moderate
if [ $? -ne 0 ]; then
  echo "âš ï¸ Security vulnerabilities detected. Please review."
  exit 1
fi

echo "ğŸ“¦ Checking for outdated dependencies..."
npm outdated
OUTDATED_EXIT_CODE=$?

if [ $OUTDATED_EXIT_CODE -eq 0 ]; then
  echo "âœ… No outdated dependencies found."
else
  echo "âš ï¸ Some dependencies are outdated. Consider updating after this commit."
fi

echo "âœ… All checks passed! Proceeding with commit..."